<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUMINARK | Consciousness Assessment Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script defer src="/_vercel/insights/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/deepchat@latest/dist/bundle.js"></script>
    <style>
        :root {
            --bg: #030305;
            --primary: #00d2ff;
            --accent: #3a7bd5;
            --emerald: #00e676;
            --amber: #ffb300;
            --danger: #ff5252;
            --violet: #8e24aa;
            --glass: rgba(15, 15, 25, 0.75);
            --border: rgba(255, 255, 255, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg);
            background-image:
                radial-gradient(circle at 10% 20%, rgba(0, 210, 255, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(142, 36, 170, 0.05) 0%, transparent 40%);
            color: #fff;
            font-family: 'Inter', -apple-system, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .app-window {
            width: 100%;
            max-width: 720px;
            background: var(--glass);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--border);
            border-radius: 40px;
            padding: 45px;
            box-shadow: 0 60px 120px -30px rgba(0, 0, 0, 0.8);
            position: relative;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: -1.5px;
            background: linear-gradient(to right, #fff, #aaa);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tagline {
            font-size: 0.7rem;
            font-family: 'JetBrains Mono';
            opacity: 0.3;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-top: 5px;
        }

        .info-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1.5px solid var(--primary);
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 8px;
            transition: 0.2s;
        }

        .info-icon:hover {
            background: rgba(0, 210, 255, 0.2);
            box-shadow: 0 0 10px rgba(0, 210, 255, 0.3);
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: rgba(0, 0, 0, 0.9);
            color: var(--primary);
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            border: 1px solid var(--border);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Section Navigation */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Form Elements */
        .vector-field {
            margin-bottom: 30px;
        }

        .label-box {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.5px;
        }

        .num-val {
            color: var(--primary);
            font-family: 'JetBrains Mono';
            font-weight: 700;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            border: 4px solid #000;
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.4);
            transition: 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 35px var(--primary);
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn-option {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: 0.3s;
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-option:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.06);
            color: #fff;
        }

        .btn-option.selected {
            background: var(--primary);
            color: #000;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.3);
        }

        .textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            color: #fff;
            padding: 18px;
            border-radius: 12px;
            font-family: inherit;
            outline: none;
            transition: 0.3s;
            min-height: 100px;
            font-size: 0.95rem;
            resize: vertical;
        }

        .textarea:focus {
            border-color: var(--primary);
            background: rgba(0, 210, 255, 0.05);
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.1);
        }

        .multi-select-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .multi-select-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: 0.3s;
            color: rgba(255, 255, 255, 0.5);
        }

        .multi-select-item:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.06);
        }

        .multi-select-item.selected {
            background: rgba(0, 210, 255, 0.2);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.2);
        }

        .btn-analyze {
            width: 100%;
            padding: 22px;
            border-radius: 20px;
            border: none;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            background: #fff;
            color: #000;
            margin-top: 15px;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn-analyze:hover {
            transform: scale(1.02);
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.15);
        }

        /* Results Display */
        .card-main {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
        }

        .stage-title {
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: -3px;
            line-height: 1;
            margin: 15px 0;
        }

        .stage-name-top {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .analysis-box {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 30px;
            border-radius: 24px;
            margin-bottom: 30px;
            text-align: left;
        }

        .section-header {
            font-weight: 800;
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--primary);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .body-text {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #ccc;
            margin-bottom: 15px;
        }

        .stage-description {
            background: rgba(0, 210, 255, 0.05);
            border-left: 3px solid var(--primary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        /* Stage Index Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 32px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.5);
            margin: 20px auto;
        }

        .stage-index-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .stage-index-num {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stage-index-name {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stage-index-desc {
            font-size: 0.85rem;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Journal Section */
        .journal-form {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
        }

        .journal-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            color: #fff;
            padding: 18px;
            border-radius: 12px;
            font-family: inherit;
            margin-bottom: 15px;
            outline: none;
            transition: 0.3s;
        }

        .journal-input:focus {
            border-color: var(--primary);
            background: rgba(0, 210, 255, 0.05);
        }

        /* Deepchat Styles */
        deep-chat {
            width: 100%;
            border-radius: 20px;
            --border-radius: 20px;
            --primary-color: #00d2ff;
            --secondary-color: rgba(255, 255, 255, 0.03);
            --text-color: #fff;
            --message-user-background-color: #00d2ff;
            --message-user-text-color: #000;
            --message-assistant-background-color: rgba(255, 255, 255, 0.05);
            --message-assistant-text-color: #fff;
            --chat-input-background-color: rgba(255, 255, 255, 0.03);
            --chat-input-border-color: rgba(255, 255, 255, 0.08);
        }

        .deepagent-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            margin: 30px 0;
            min-height: 400px;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            overflow: auto;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .modal-close {
            cursor: pointer;
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.5);
            transition: 0.2s;
            margin-top: -20px;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .processing-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(3, 3, 5, 0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            border-radius: 40px;
        }

        .loader-ring {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 210, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .proc-text {
            font-family: 'JetBrains Mono';
            font-size: 0.8rem;
            color: var(--primary);
            letter-spacing: 2px;
        }
    </style>
</head>
<body>
    <div class="app-window">
        <!-- Processing Overlay -->
        <div class="processing-overlay" id="processingOverlay">
            <div class="loader-ring"></div>
            <div class="proc-text">CALCULATING...</div>
        </div>

        <!-- Section 1: Welcome -->
        <div class="section active" id="section1">
            <header>
                <h1>LUMINARK</h1>
                <p class="tagline">Consciousness Assessment Platform</p>
            </header>

            <div style="text-align: center; margin-bottom: 30px;">
                <p style="font-size: 0.95rem; line-height: 1.6; color: rgba(255, 255, 255, 0.7);">
                    Discover your current consciousness stage through a comprehensive assessment of your life dynamics, emotional state, and personal vectors.
                </p>
            </div>

            <button class="btn-analyze" onclick="nextSection(1)">Begin Assessment ‚Üí</button>
        </div>

        <!-- Section 2: Temporal Reflection -->
        <div class="section" id="section2">
            <header>
                <h1>Future & Past</h1>
                <p class="tagline">Understanding Your Temporal Perspective</p>
            </header>

            <div class="vector-field">
                <div class="label-box">
                    <span>How do you see your future?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">What do you see coming? Be honest about your hopes and concerns.</span>
                        </span>
                    </span>
                </div>
                <textarea class="textarea" id="futureReflection" placeholder="Describe your vision for the future in detail..."></textarea>
            </div>

            <div class="vector-field">
                <div class="label-box">
                    <span>How do you view your past?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">What has your past taught you? What wounds or wisdom do you carry?</span>
                        </span>
                    </span>
                </div>
                <textarea class="textarea" id="pastReflection" placeholder="Describe what your past means to you..."></textarea>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn-analyze" onclick="nextSection(2)" style="flex: 1;">Next ‚Üí</button>
                <button class="btn-analyze" onclick="prevSection(2)" style="flex: 1; background: rgba(255,255,255,0.1); color: #fff;">‚Üê Back</button>
            </div>
        </div>

        <!-- Section 3: Life Focus Areas -->
        <div class="section" id="section3">
            <header>
                <h1>Life Focus Areas</h1>
                <p class="tagline">Select areas that resonate with your current life</p>
            </header>

            <div class="vector-field">
                <div class="label-box">
                    <span>Which areas matter most to you right now?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">Pick multiple areas. Where is your energy going?</span>
                        </span>
                    </span>
                </div>
                <div class="multi-select-container" id="lifeVectorContainer"></div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn-analyze" onclick="nextSection(3)" style="flex: 1;">Next ‚Üí</button>
                <button class="btn-analyze" onclick="prevSection(3)" style="flex: 1; background: rgba(255,255,255,0.1); color: #fff;">‚Üê Back</button>
            </div>
        </div>

        <!-- Section 4: Life Metrics -->
        <div class="section" id="section4">
            <header>
                <h1>Life Metrics</h1>
                <p class="tagline">Rate your current state</p>
            </header>

            <div class="vector-field">
                <div class="label-box">
                    <span>Complexity: How many moving parts?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">Is your life simple or complicated right now? How many things are happening at once?</span>
                        </span>
                    </span>
                    <span class="num-val" id="val-complexity">5</span>
                </div>
                <input type="range" id="complexity" min="0" max="10" value="5" onchange="updateValue('complexity')">
            </div>

            <div class="vector-field">
                <div class="label-box">
                    <span>Stability: How grounded do you feel?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">Do you feel secure or shaky? Is your foundation solid?</span>
                        </span>
                    </span>
                    <span class="num-val" id="val-stability">5</span>
                </div>
                <input type="range" id="stability" min="0" max="10" value="5" onchange="updateValue('stability')">
            </div>

            <div class="vector-field">
                <div class="label-box">
                    <span>Tension: How much pressure inside?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">Are you calm or stressed? How much conflict do you feel?</span>
                        </span>
                    </span>
                    <span class="num-val" id="val-tension">5</span>
                </div>
                <input type="range" id="tension" min="0" max="10" value="5" onchange="updateValue('tension')">
            </div>

            <div class="vector-field">
                <div class="label-box">
                    <span>Flexibility: Can you adapt?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">Can you bend and adjust, or do you feel stuck?</span>
                        </span>
                    </span>
                    <span class="num-val" id="val-adaptability">5</span>
                </div>
                <input type="range" id="adaptability" min="0" max="10" value="5" onchange="updateValue('adaptability')">
            </div>

            <div class="vector-field">
                <div class="label-box">
                    <span>Meaning: Does it all make sense?
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">Does your life have direction and purpose?</span>
                        </span>
                    </span>
                    <span class="num-val" id="val-coherence">5</span>
                </div>
                <input type="range" id="coherence" min="0" max="10" value="5" onchange="updateValue('coherence')">
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn-analyze" onclick="runAnalysis()" style="flex: 1;">Generate Reading ‚Üí</button>
                <button class="btn-analyze" onclick="prevSection(4)" style="flex: 1; background: rgba(255,255,255,0.1); color: #fff;">‚Üê Back</button>
            </div>
        </div>

        <!-- Section 5: Results -->
        <div class="section" id="section5">
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn-analyze" onclick="openStageIndex()" style="background: rgba(0, 210, 255, 0.1); color: var(--primary); border: 1px solid var(--primary); width: auto; padding: 10px 30px;">üìö View Stage Index</button>
            </div>

            <div class="card-main">
                <div class="stage-name-top" id="stageName">Stage</div>
                <div class="stage-title" id="stageNumber">0</div>
            </div>

            <div class="analysis-box" id="analysisContent"></div>

            <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border);">
                <h2 style="font-size: 1.4rem; margin-bottom: 20px; color: var(--primary);">Deep Agent Chat</h2>
                <div class="deepagent-container">
                    <deep-chat
                        request="{
                            'url': '/api/chat',
                            'method': 'POST',
                            'headers': {'Content-Type': 'application/json'}
                        }"
                    ></deep-chat>
                </div>
            </div>            <div class="journal-form">
                <h2 style="font-size: 1.4rem; margin-bottom: 20px; color: var(--primary);">Journal Entry</h2>
                
                <div class="vector-field">
                    <label class="label-box">Entry Type</label>
                    <div class="button-group">
                        <button class="btn-option" id="journalWeekly" onclick="selectJournalType('weekly')">Weekly</button>
                        <button class="btn-option" id="journalMonthly" onclick="selectJournalType('monthly')">Monthly</button>
                    </div>
                </div>

                <div class="vector-field">
                    <label class="label-box">Reflection Notes</label>
                    <textarea class="textarea" id="journalNotes" placeholder="Document your thoughts, progress, and insights..."></textarea>
                </div>

                <button class="btn-analyze" onclick="saveJournal()">Save Journal Entry</button>
            </div>

            <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border);">
                <h2 style="font-size: 1.4rem; margin-bottom: 20px; color: var(--primary);">Your Progress</h2>
                <div class="chart-container" id="chartContainer">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>

            <button class="btn-analyze" onclick="startOver()" style="margin-top: 20px; background: rgba(255,255,255,0.1); color: #fff;">‚Üê Start Over</button>
        </div>
    </div>

    <!-- Stage Index Modal -->
    <div class="modal-overlay" id="stageModal">
        <div class="modal-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="font-size: 1.8rem;">The 10 Stages</h2>
                <span class="modal-close" onclick="closeStageIndex()">√ó</span>
            </div>
            <div id="stageIndexContent"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const LIFE_VECTORS = [
            "Relationship", "Career", "Family", "Finances", "Health", "Self-Growth",
            "Spirituality", "Creative Expression", "Purpose/Mission", "Social Impact",
            "Adventure", "Independence", "Power", "Community", "Security",
            "Learning", "Healing", "Personal Recovery"
        ];

        const STAGES = {
            0: { name: "The Void", subtitle: "Plenara", desc: "You are in a state of pure potential‚Äîbefore beginnings or after endings. This is a time of stillness, deep rest, or profound reset where there is no structure, only possibility. You may feel empty, peaceful, or unformed. Trust this space‚Äîit is the source of all creation." },
            1: { name: "The Spark", subtitle: "Stage 1", desc: "You've felt a new impulse‚Äîan idea, a feeling, or a calling‚Äîbut it has no shape yet. This is a fragile, exciting moment of inspiration without clear direction. Your essence is stable, but your form is not, so nurture this spark without forcing it into being." },
            2: { name: "The Vessel", subtitle: "Stage 2", desc: "You are now giving form to your spark, creating boundaries and defining yourself in relation to others. This stage brings duality: self and other, yes and no, inner and outer as you build a container for your life. The vessel feels stable, but what's inside is still shifting‚Äîbe gentle with yourself as you take shape." },
            3: { name: "Initiation", subtitle: "Stage 3", desc: "You are entering motion‚Äîchaotic, creative, and sometimes overwhelming. This is where you take your first real steps into the world, often through action, risk, or expression. The container may feel unstable, but your inner truth is strong, so embrace the chaos‚Äîit's part of the path." },
            4: { name: "Foundation", subtitle: "Stage 4", desc: "You are building structure: habits, systems, routines, and stability that create order and security. This stage is about creating a reliable base for your life where everything feels solid. The structure feels real, but what you put inside it may still feel uncertain‚Äîlay your bricks with care." },
            5: { name: "The Threshold", subtitle: "Stage 5", desc: "You are at a critical choice point‚Äîa moment of maximum tension and potential where everything could change. This is where you decide: move forward into growth or retreat to safety, and your choice will define your trajectory. Adaptability is key, and this next step will shape everything that comes after." },
            6: { name: "The Fragile Peak", subtitle: "Stage 6", desc: "You are experiencing harmony, flow, and high performance‚Äîbut it's delicate and temporary. Everything seems to be working, yet you sense it could unravel easily, so enjoy it without clinging to it. This is a beautiful moment, but build no permanent home here‚Äîappreciate the view and prepare for change." },
            7: { name: "Transformation", subtitle: "Stage 7", desc: "You are in a period of breakdown or breakthrough where old structures crack to make room for wisdom. This stage can feel like a crisis, a loss, or a profound shift in identity that shakes your foundation. The outer container is unstable, but what you're learning inside is eternal‚Äîlet go to grow." },
            8: { name: "The Truth Trap", subtitle: "Stage 8", desc: "You have gained deep wisdom or insight, but risk becoming rigid or attached to 'having the truth' that turns into dogma. This is a stage of clarity that feels stable, but your mind can become fixed if you're not careful. Stay open‚Äîwisdom flows, it doesn't settle into permanent forms." },
            9: { name: "The Return", subtitle: "Stage 9", desc: "You are completing a cycle, integrating all you've learned, and preparing to release form. This is a stage of conscious completion, teaching, or graceful closure where you are dissolving back into essence. You are carrying wisdom without attachment, and you are ready to begin again." }
        };

        let currentState = {
            futureReflection: "",
            pastReflection: "",
            lifeVectors: [],
            metrics: { complexity: 5, stability: 5, tension: 5, adaptability: 5, coherence: 5 },
            stage: 0,
            journalEntries: []
        };

        let chartInstance = null;

        function initializeVectors() {
            const container = document.getElementById('lifeVectorContainer');
            container.innerHTML = '';
            LIFE_VECTORS.forEach(vector => {
                const item = document.createElement('div');
                item.className = 'multi-select-item';
                item.textContent = vector;
                item.onclick = () => toggleVector(vector, item);
                container.appendChild(item);
            });
        }

        function toggleVector(vector, element) {
            const index = currentState.lifeVectors.indexOf(vector);
            if (index > -1) {
                currentState.lifeVectors.splice(index, 1);
                element.classList.remove('selected');
            } else {
                currentState.lifeVectors.push(vector);
                element.classList.add('selected');
            }
        }

        function nextSection(current) {
            if (current === 1) {
                currentState.futureReflection = document.getElementById('futureReflection').value;
                currentState.pastReflection = document.getElementById('pastReflection').value;
            }
            document.getElementById(`section${current}`).classList.remove('active');
            document.getElementById(`section${current + 1}`).classList.add('active');
            if (current === 2) initializeVectors();
            window.scrollTo(0, 0);
        }

        function prevSection(current) {
            document.getElementById(`section${current}`).classList.remove('active');
            document.getElementById(`section${current - 1}`).classList.add('active');
            window.scrollTo(0, 0);
        }

        function updateValue(metric) {
            const value = document.getElementById(metric).value;
            currentState.metrics[metric] = parseInt(value);
            document.getElementById(`val-${metric}`).textContent = value;
        }

        function calculateStage() {
            const avg = Object.values(currentState.metrics).reduce((a, b) => a + b) / 5;
            return Math.round(avg);
        }

        function runAnalysis() {
            const overlay = document.getElementById('processingOverlay');
            overlay.style.display = 'flex';
            
            setTimeout(() => {
                currentState.stage = calculateStage();
                displayResults();
                overlay.style.display = 'none';
                document.getElementById('section4').classList.remove('active');
                document.getElementById('section5').classList.add('active');
                window.scrollTo(0, 0);
            }, 1500);
        }

        function displayResults() {
            const stage = STAGES[currentState.stage];
            document.getElementById('stageName').textContent = `${stage.name} ‚Äî ${stage.subtitle}`;
            document.getElementById('stageNumber').textContent = currentState.stage;
            
            let content = `
                <div class="section-header">Your Current Stage</div>
                <div class="body-text">${stage.desc}</div>
                <div class="stage-description">
                    <strong>Your Metrics:</strong><br>
                    Complexity: ${currentState.metrics.complexity}/10<br>
                    Stability: ${currentState.metrics.stability}/10<br>
                    Tension: ${currentState.metrics.tension}/10<br>
                    Adaptability: ${currentState.metrics.adaptability}/10<br>
                    Coherence: ${currentState.metrics.coherence}/10
                </div>
                <div class="section-header" style="margin-top: 20px;">Focus Areas</div>
                <div class="body-text">${currentState.lifeVectors.join(", ") || "No areas selected"}</div>
            `;
            document.getElementById('analysisContent').innerHTML = content;
            updateChart();
        }

        function selectJournalType(type) {
            document.getElementById('journalWeekly').classList.remove('selected');
            document.getElementById('journalMonthly').classList.remove('selected');
            document.getElementById(`journal${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('selected');
        }

        function saveJournal() {
            const notes = document.getElementById('journalNotes').value;
            if (!notes.trim()) {
                alert('Please write some notes before saving');
                return;
            }

            const entry = {
                date: new Date().toLocaleDateString(),
                stage: currentState.stage,
                notes: notes,
                metrics: { ...currentState.metrics }
            };

            currentState.journalEntries.push(entry);
            localStorage.setItem('luminarkJournal', JSON.stringify(currentState.journalEntries));
            document.getElementById('journalNotes').value = '';
            updateChart();
            alert('Journal entry saved!');
        }

        function updateChart() {
            const entries = currentState.journalEntries;
            if (entries.length === 0) {
                document.getElementById('chartContainer').innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 40px;">Save journal entries to see your progression chart</p>';
                return;
            }

            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            const labels = entries.map(e => e.date);
            const stages = entries.map(e => e.stage);

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Consciousness Stage',
                        data: stages,
                        borderColor: '#00d2ff',
                        backgroundColor: 'rgba(0, 210, 255, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#00d2ff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 10,
                            ticks: { color: '#aaa' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        x: {
                            ticks: { color: '#aaa' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });
        }

        function openStageIndex() {
            const content = Object.entries(STAGES).map(([num, stage]) => `
                <div class="stage-index-item">
                    <div class="stage-index-num">${num}</div>
                    <div class="stage-index-name">${stage.name} ‚Äî ${stage.subtitle}</div>
                    <div class="stage-index-desc">${stage.desc}</div>
                </div>
            `).join('');
            
            document.getElementById('stageIndexContent').innerHTML = content;
            document.getElementById('stageModal').style.display = 'flex';
        }

        function closeStageIndex() {
            document.getElementById('stageModal').style.display = 'none';
        }

        function startOver() {
            location.reload();
        }

        // Load journal entries on startup
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('luminarkJournal');
            if (saved) {
                currentState.journalEntries = JSON.parse(saved);
            }
        });

        // Close modal when clicking outside
        document.getElementById('stageModal').onclick = function(e) {
            if (e.target === this) closeStageIndex();
        };
    </script>
</body>
</html>
